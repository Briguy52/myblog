<h4 id="introduction">Introduction</h4>

<p>This will be a close-to-comprehensive guide on how to get started creating PDF and LaTeX files from .rst (reStructuredText) using Sphinx. If you’re not familiar with Sphinx, it’s a documentation generator that takes .rst files and converts them into other formats (such as HTML, PDF, LaTeX, etc.)</p>

<p>Recommended knowledge:</p>

<blockquote>
  <p>A basic understanding of programming (preferably Python)</p>

  <p>Familiarity with basic Mac Terminal concepts and commands (<code class="highlighter-rouge">open,cd,ls,pwd,sudo</code>,etc.)</p>

  <p>You can visit Duke’s <a href="http://pundit.pratt.duke.edu/wiki/UNIX_Tutorial">Unix Tutorial</a> for some good examples and explanations.</p>

  <p>A good deal of patience and Google-fu when you get stuck!</p>
</blockquote>

<p>Note: While you don’t need to be familiar with LaTeX formatting (since Sphinx and MacTeX will do that for you), if you need to do any ‘White Box’ work, it will come in handy!</p>

<h4 id="installation">Installation</h4>

<p>Your Mac should come with Python 2.7 installed. You may install Python 3 if you wish, but this writeup will use Python 2.7 because that is what I have.</p>

<p>Install Sphinx according to the <a href="http://sphinx-doc.org/latest/install.html">documentation</a> on their website. I used MacPorts to install Sphinx as they recommended and then did the ‘quick start’ setup. Google ‘Sphinx QuickStart’ for a thorough explanation of the process.</p>

<p>Download and install <a href="https://tug.org/mactex/">MacTeX</a>. Make sure you download the package with Safari and have sufficient space on your computer. I believe the full package (which you need) takes up around 4-5 gb of space. Note: if space is an issue, you may want to consider avoiding LaTeX and trying rst2pdf or a similar Sphinx extension. However, these alternatives will not be covered in this tutorial.</p>

<h4 id="anatomy-of-a-sphinx-main-directory">Anatomy of a Sphinx Main Directory</h4>

<p>There are many files and folders created within your Main Directory. In this writeup, we will only concern ourselves with the relevant ones: conf.py, Makefile, _build, and index.rst.</p>

<p><strong>conf.py</strong> is our configuration file. This contains your settings from the Sphinx quick start. We can also add extensions (such as rst2pdf) as well as additional options (such as LaTeX, PDF, or HTML options). Since this is a Python script (due to the .py extension), make sure you follow correct Python formatting. If you do not know Python formatting, copy-paste is your friend. Note: a common syntax error arises from TextEdit modifying apostrophes from good vertical apostrophes (‘) to bad slanted apostrophes (‘). Make sure all your apostrophes are vertical!</p>

<p>The <strong>Makefile</strong> contains various command shortcuts that you can run in terminal. For example, instead of having to type in:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sphinx-build -b latex -d _build/doctrees   . _build/latex
</code></pre>
</div>

<p>We can simply type:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>make latex 
</code></pre>
</div>

<p>Which will go into the Makefile and run the more complicated code.</p>

<p>The <strong>_build</strong> (builddir) folder contains the files that we build. This includes both the final result (such as a PDF) as well as all the intermediate files (such as a .tex). You can name this folder whatever you want; I simply chose ‘_build’</p>

<p>Finally, you will need an <strong>index.rst</strong> file. This has to be an .rst or .txt file (depending on your config settings) and the name does not matter as long as it’s consistent with conf.py. This file will be formatted in reStructuredText (hence the .rst extension) and contains the actual content that will be translated into LaTeX and then PDF.</p>

<h4 id="config-and-makefile-setup">Config and Makefile Setup</h4>

<p>Your Makefile should come with the correct commands preset. In case you’re missing ‘latex’ and ‘latexpdf’, copy in the following:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>latex:
	$(SPHINXBUILD) -b latex $(ALLSPHINXOPTS) $(BUILDDIR)/latex
	@echo
	@echo "Build finished; the LaTeX files are in $(BUILDDIR)/latex."
	@echo "Run \`make' in that directory to run these through (pdf)latex" \
      	"(use \`make latexpdf' here to do that automatically)."

latexpdf:
	$(SPHINXBUILD) -b latex $(ALLSPHINXOPTS) $(BUILDDIR)/latex
	@echo "Running LaTeX files through pdflatex..."
	$(MAKE) -C $(BUILDDIR)/latex all-pdf
	@echo "pdflatex finished; the PDF files are in $(BUILDDIR)/latex."
</code></pre>
</div>

<p>Note that <code class="highlighter-rouge">latexpdf</code> contains the <code class="highlighter-rouge">latex</code> command along with the <code class="highlighter-rouge">make all-pdf</code> command.</p>

<p>In your <code class="highlighter-rouge">conf.py</code> file, you should find a section entitled <strong>Options for LaTeX output</strong>. Read through it and modify the presets to fit your project. For most, that means specifying your desired document title and source in the <code class="highlighter-rouge">latex_document</code> setting.</p>

<h4 id="tex-and-pdf-creation">.tex and PDF Creation</h4>

<p>If all your files are the correct places (i.e. from your directory you should be able to see Makefile, conf.py, _build, and index.rst), all that you need to do now is type in:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>make latexpdf
</code></pre>
</div>

<p>It will take a couple moments, but then you will find your freshly created filename.pdf in your _build/latex folder (along with all the intermediate files).</p>

<h4 id="pdflatex-issues">pdflatex Issues</h4>

<p>You may have encountered an error about <code class="highlighter-rouge">pdflatex not found</code> or something of the sort. <code class="highlighter-rouge">pdflatex</code> is an executable that comes along with MacTeX. But even after installing the full MacTeX package, I was still getting this error!</p>

<p>After some Googling, I found a very helpful <a href="https://support.rstudio.com/hc/communities/public/questions/201410073-pdflatex-error-on-OSX">post</a> on R Studio.</p>

<p>User Dave Dyer suggested entering the following lines into your terminal:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo ln -s /Library/TeX/Distributions/.DefaultTeX/Contents/Programs/texbin/usr/texbin
sudo ln -s /usr/texbin/pdflatex /usr/bin/pdflatex 
</code></pre>
</div>

<p>And that did it for me! Basically, even though you have the <code class="highlighter-rouge">pdflatex</code> file installed, Sphinx can’t find it when you run the <code class="highlighter-rouge">make latexpdf</code> command. To fix this, you simply need to specify the correct file paths using the <code class="highlighter-rouge">ln</code> command (link).</p>

<h4 id="creating-multiple-pdfs">Creating Multiple PDFs</h4>

<p>You may want to create multiple PDFs using multiple .rst files. The intuitive way to do this would be to simply go folder by folder and repeat this process. (I am currently working on a more elegant solution that retains the single ‘make latexpdf’ process).</p>

<p>First, I recommend that you familiarize yourself with the <code class="highlighter-rouge">sphinx-build</code> command’s many options that can be found in Sphinx’s <a href="http://sphinx-doc.org/invocation.html">documentation</a>. The ones that we will cover are <code class="highlighter-rouge">-b, -d, and -c</code>.</p>

<p>Here is the general format for <code class="highlighter-rouge">sphinx-build</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sphinx-build [options] sourcedir builddir [filenames]
</code></pre>
</div>

<p>‘-b’ gives the <code class="highlighter-rouge">buildername</code>, such as <code class="highlighter-rouge">html</code> or <code class="highlighter-rouge">latex</code>. We will be using <code class="highlighter-rouge">latex</code>.</p>

<p>‘-d’ specifies the path within the source directory. This is what’s used when we run ‘make latex’</p>

<p>‘-c’ specifies the path somewhere other than the source directory. This is what we will use.</p>

<p>To convert your .rst file into a .tex file, run the following:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sphinx-build -b latex -c /foo/bar/folder . /foo/bar/folder/_build/latex
</code></pre>
</div>

<p>This takes the index.rst file in <code class="highlighter-rouge">folder</code> and outputs a corresponding .tex file within <code class="highlighter-rouge">folder/_build/latex</code>.</p>

<p>Now, <code class="highlighter-rouge">cd</code> over to the .tex file’s folder:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cd /foo/bar/folder/_build/latex
</code></pre>
</div>

<p>And let’s convert everything there to PDF:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>make all-pdf
</code></pre>
</div>

<p>As the name implies, <code class="highlighter-rouge">make all-pdf</code> converts all the .tex files in a folder to PDFs. If you have multiple .rst files, have them output their .tex files to the same folder (such as <code class="highlighter-rouge">/home/_build/latex</code>) and then run <code class="highlighter-rouge">make all-pdf</code> at the very end.</p>

<p>This <a href="https://groups.google.com/forum/#!topic/sphinx-users/XNnVdAhTC7A">Google groups post</a> started by Lenz Grimmer was especially helpful to me. I recommend you give it a skim.</p>

<h4 id="closing">Closing</h4>

<p>Thank you for reading this writeup! I will update this article as a I learn new things and encounter new obstacles. Pictures and screenshots will be added soon though they shouldn’t be necessary to understand the process.</p>

<p>Please contact me with any questions, suggestions, or criticisms at bri@brianmlin.com.</p>

<p><em>Last updated: Tuesday, May 26th, 2015</em></p>
